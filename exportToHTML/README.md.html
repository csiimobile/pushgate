<html>
<head>
<title>README.md</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #a9b7c6;}
.s3 { color: #808080;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
README.md</font>
</center></td></tr></table>
<pre><span class="s0"># </span><span class="s2">推送通知网关</span>

<span class="s0">## </span><span class="s2">支持平台</span>

<span class="s0">- </span><span class="s1">[</span><span class="s2">苹果APNS</span><span class="s1">](https://developer.apple.com/library/content/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/APNSOverview.html)</span>
<span class="s0">- </span><span class="s1">[</span><span class="s2">安卓FCM</span><span class="s1">](https://firebase.google.com/)</span>
<span class="s0">- </span><span class="s1">[</span><span class="s2">华为HMS</span><span class="s1">](https://developer.huawei.com/consumer/cn/hms/)</span>

<span class="s0">## </span><span class="s2">功能特性</span>

<span class="s0">- </span><span class="s2">支持境外安卓 </span><span class="s1">[</span><span class="s2">Firebase Cloud Messaging</span><span class="s1">](https://firebase.google.com/docs/cloud-messaging) </span><span class="s2">。</span>
<span class="s0">- </span><span class="s2">支持苹果iOS/Mac </span><span class="s1">[</span><span class="s2">Apple Push Notification Service</span><span class="s1">](https://developer.apple.com/library/content/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/APNSOverview.html) </span><span class="s2">。</span>
<span class="s0">- </span><span class="s2">支持华为 </span><span class="s1">[</span><span class="s2">HMS Push Service</span><span class="s1">](https://developer.huawei.com/consumer/en/hms/huawei-pushkit) </span><span class="s2">，向安卓和鸿蒙设备发送通知。</span>
<span class="s0">- </span><span class="s2">支持集中配置管理。</span>
<span class="s0">- </span><span class="s2">支持通过命令行发送单条推送通知。</span>
<span class="s0">- </span><span class="s2">支持通过RESTful API发送推送通知。</span>
<span class="s0">- </span><span class="s2">支持HTTP/2 和 HTTP/1.1 协议。</span>
<span class="s0">- </span><span class="s2">支持消息队列及多路并发。</span>
<span class="s0">- </span><span class="s2">支持发送状态统计。</span>

<span class="s0">### </span><span class="s2">发送安卓通知</span>

<span class="s2">使用如下命令发送单条安卓通知：</span>

<span class="s3">```bash</span>
<span class="s3">pushgate -android -m &quot;your message&quot; -k &quot;API Key&quot; -t &quot;Device token&quot;</span>
<span class="s3">```</span>

<span class="s2">发送通知到主题：</span>

<span class="s3">```bash</span>
<span class="s3">pushgate --android --topic &quot;/topics/foo-bar&quot; \</span>
  <span class="s3">-m &quot;This is a Firebase Cloud Messaging Topic Message&quot; \</span>
  <span class="s3">-k your_api_key</span>
<span class="s3">```</span>

<span class="s0">- </span><span class="s3">`</span><span class="s2">-m</span><span class="s3">`</span><span class="s1">: </span><span class="s2">通知消息正文</span>
<span class="s0">- </span><span class="s3">`</span><span class="s2">-k</span><span class="s3">`</span><span class="s1">: [</span><span class="s2">Firebase Cloud Messaging</span><span class="s1">](https://firebase.google.com/docs/cloud-messaging) </span><span class="s2">密钥（api key）</span>
<span class="s0">- </span><span class="s3">`</span><span class="s2">-t</span><span class="s3">`</span><span class="s1">: </span><span class="s2">设备令牌</span>
<span class="s0">- </span><span class="s3">`</span><span class="s2">--title</span><span class="s3">`</span><span class="s1">: </span><span class="s2">通知消息标题</span>
<span class="s0">- </span><span class="s3">`</span><span class="s2">--topic</span><span class="s3">`</span><span class="s1">: </span><span class="s2">发送消息到主题，此模式下无需指定设备令牌</span>
<span class="s0">- </span><span class="s3">`</span><span class="s2">--proxy</span><span class="s3">`</span><span class="s1">: </span><span class="s2">设置代理服务器</span>

<span class="s0">### </span><span class="s2">发送华为（HMS）推送通知</span>

<span class="s2">使用如下命令发送单条华为通知：</span>

<span class="s3">```bash</span>
<span class="s3">pushgate -huawei -title &quot;Notification Title&quot; -m &quot;your message&quot; -hk &quot;API Key&quot; -hid &quot;App ID&quot; -t &quot;Device token&quot;</span>
<span class="s3">```</span>

<span class="s2">发送通知到主题：</span>

<span class="s3">```bash</span>
<span class="s3">pushgate --huawei --topic &quot;foo-bar&quot; \</span>
  <span class="s3">-title &quot;Notification Title&quot; \</span>
  <span class="s3">-m &quot;This is a Huawei Mobile Services Topic Message&quot; \</span>
  <span class="s3">-hk &quot;API Key&quot; \</span>
  <span class="s3">-hid &quot;App ID&quot;</span>
<span class="s3">```</span>

<span class="s0">- </span><span class="s3">`</span><span class="s2">-m</span><span class="s3">`</span><span class="s1">: </span><span class="s2">通知消息正文</span>
<span class="s0">- </span><span class="s3">`</span><span class="s2">-hk</span><span class="s3">`</span><span class="s1">: [</span><span class="s2">Huawei Mobile Services</span><span class="s1">](https://developer.huawei.com/consumer/en/doc/development/HMS-Guides/Preparations) </span><span class="s2">密钥（api secret）</span>
<span class="s0">- </span><span class="s3">`</span><span class="s2">-t</span><span class="s3">`</span><span class="s1">: </span><span class="s2">设备令牌</span>
<span class="s0">- </span><span class="s3">`</span><span class="s2">--title</span><span class="s3">`</span><span class="s1">: </span><span class="s2">通知消息标题</span>
<span class="s0">- </span><span class="s3">`</span><span class="s2">--topic</span><span class="s3">`</span><span class="s1">: </span><span class="s2">发送消息到主题，此模式下无需指定设备令牌</span>
<span class="s0">- </span><span class="s3">`</span><span class="s2">--proxy</span><span class="s3">`</span><span class="s1">: </span><span class="s2">设置代理服务器</span>

<span class="s0">### </span><span class="s2">发送苹果（iOS/Mac）通知</span>

<span class="s2">使用如下命令发送单条苹果通知：</span>

<span class="s3">```bash</span>
<span class="s3">pushgate -ios -m &quot;your message&quot; -i &quot;your certificate path&quot; \</span>
  <span class="s3">-t &quot;device token&quot; --topic &quot;apns topic&quot;</span>
<span class="s3">```</span>

<span class="s0">- </span><span class="s3">`</span><span class="s2">-m</span><span class="s3">`</span><span class="s1">: </span><span class="s2">通知消息正文</span>
<span class="s0">- </span><span class="s3">`</span><span class="s2">-i</span><span class="s3">`</span><span class="s1">: </span><span class="s2">证书路径 </span><span class="s1">(</span><span class="s3">`</span><span class="s2">pem</span><span class="s3">` </span><span class="s2">或 </span><span class="s3">`</span><span class="s2">p12</span><span class="s3">` </span><span class="s2">文件</span><span class="s1">)</span>
<span class="s0">- </span><span class="s3">`</span><span class="s2">-t</span><span class="s3">`</span><span class="s1">: </span><span class="s2">设备令牌</span>
<span class="s0">- </span><span class="s3">`</span><span class="s2">--title</span><span class="s3">`</span><span class="s1">: </span><span class="s2">通知消息标题</span>
<span class="s0">- </span><span class="s3">`</span><span class="s2">--topic</span><span class="s3">`</span><span class="s1">: </span><span class="s2">通知主题</span>
<span class="s0">- </span><span class="s3">`</span><span class="s2">--password</span><span class="s3">`</span><span class="s1">: </span><span class="s2">证书密码</span>

<span class="s2">默认发送到开发环境。 添加 </span><span class="s3">`</span><span class="s2">-production</span><span class="s3">` </span><span class="s2">参数可以发送到生产环境。</span>

<span class="s3">```bash</span>
<span class="s3">pushgate -ios -m &quot;your message&quot; -i &quot;your certificate path&quot; \</span>
  <span class="s3">-t &quot;device token&quot; \</span>
  <span class="s3">-production</span>
<span class="s3">```</span>

<span class="s0">## </span><span class="s2">启动网关服务</span>

<span class="s2">请确认配置文件 </span><span class="s1">[</span><span class="s2">config.yml</span><span class="s1">](</span><span class="s2">config.yml</span><span class="s1">) </span><span class="s2">存在。 默认端口为 </span><span class="s3">`</span><span class="s2">8088</span><span class="s3">`</span><span class="s2">。</span>

<span class="s3">```bash</span>
<span class="s3"># 加载默认配置文件，同路径下的config.yml</span>
<span class="s3">pushgate</span>
<span class="s3"># 加载指定的配置文件</span>
<span class="s3">pushgate -c path/config.yml</span>
<span class="s3">```</span>

<span class="s0">## </span><span class="s2">网关API</span>

<span class="s2">推送通知网关支持如下API：</span>

<span class="s0">- </span><span class="s1">**</span><span class="s2">GET</span><span class="s1">**  </span><span class="s3">`</span><span class="s2">/api/stat/app</span><span class="s3">` </span><span class="s2">获取推送通知的成功、失败计数信息</span>
<span class="s0">- </span><span class="s1">**</span><span class="s2">POST</span><span class="s1">** </span><span class="s3">`</span><span class="s2">/api/push</span><span class="s3">` </span><span class="s2">发送推送通知</span>


<span class="s0">### </span><span class="s2">GET /api/stat/app</span>

<span class="s2">获取推送通知的成功和失败计数。</span>

<span class="s3">```json</span>
<span class="s3">{</span>
  <span class="s3">&quot;version&quot;: &quot;v1.0.0&quot;,</span>
  <span class="s3">&quot;queue_max&quot;: 8192,</span>
  <span class="s3">&quot;queue_usage&quot;: 0,</span>
  <span class="s3">&quot;total_count&quot;: 77,</span>
  <span class="s3">&quot;ios&quot;: {</span>
    <span class="s3">&quot;push_success&quot;: 19,</span>
    <span class="s3">&quot;push_error&quot;: 38</span>
  <span class="s3">},</span>
  <span class="s3">&quot;android&quot;: {</span>
    <span class="s3">&quot;push_success&quot;: 10,</span>
    <span class="s3">&quot;push_error&quot;: 10</span>
  <span class="s3">},</span>
  <span class="s3">&quot;huawei&quot;: {</span>
    <span class="s3">&quot;push_success&quot;: 3,</span>
    <span class="s3">&quot;push_error&quot;: 1</span>
  <span class="s3">}</span>
<span class="s3">}</span>
<span class="s3">```</span>

<span class="s0">### </span><span class="s2">POST /api/push</span>

<span class="s2">通过API发送通知。</span>

<span class="s2">发送苹果推送通知, </span><span class="s3">`</span><span class="s2">platform</span><span class="s3">` </span><span class="s2">设置为 </span><span class="s3">`</span><span class="s2">1</span><span class="s3">`</span><span class="s1">:</span>

<span class="s3">```json</span>
<span class="s3">{</span>
  <span class="s3">&quot;notifications&quot;: [</span>
    <span class="s3">{</span>
      <span class="s3">&quot;tokens&quot;: [&quot;token_a&quot;, &quot;token_b&quot;],</span>
      <span class="s3">&quot;platform&quot;: 1,</span>
      <span class="s3">&quot;message&quot;: &quot;Hello World iOS!&quot;</span>
    <span class="s3">}</span>
  <span class="s3">]</span>
<span class="s3">}</span>
<span class="s3">```</span>

<span class="s2">发送境外安卓通知，</span><span class="s3">`</span><span class="s2">platform</span><span class="s3">` </span><span class="s2">设置为 </span><span class="s3">`</span><span class="s2">2</span><span class="s3">`</span><span class="s1">:</span>

<span class="s3">```json</span>
<span class="s3">{</span>
  <span class="s3">&quot;notifications&quot;: [</span>
    <span class="s3">{</span>
      <span class="s3">&quot;tokens&quot;: [&quot;token_a&quot;, &quot;token_b&quot;],</span>
      <span class="s3">&quot;platform&quot;: 2,</span>
      <span class="s3">&quot;message&quot;: &quot;Hello World Android!&quot;</span>
    <span class="s3">}</span>
  <span class="s3">]</span>
<span class="s3">}</span>
<span class="s3">```</span>

<span class="s2">发送华为通知消息, </span><span class="s3">`</span><span class="s2">platform</span><span class="s3">` </span><span class="s2">设置为 </span><span class="s3">`</span><span class="s2">3</span><span class="s3">`</span><span class="s1">:</span>

<span class="s3">```json</span>
<span class="s3">{</span>
  <span class="s3">&quot;notifications&quot;: [</span>
    <span class="s3">{</span>
      <span class="s3">&quot;tokens&quot;: [&quot;token_a&quot;, &quot;token_b&quot;],</span>
      <span class="s3">&quot;platform&quot;: 3,</span>
      <span class="s3">&quot;title&quot;: &quot;Hello with HMS&quot;,</span>
      <span class="s3">&quot;message&quot;: &quot;Hello World Huawei!&quot;</span>
    <span class="s3">}</span>
  <span class="s3">]</span>
<span class="s3">}</span>
<span class="s3">```</span>

<span class="s2">同时发送多条多平台通知：</span>

<span class="s3">```json</span>
<span class="s3">{</span>
  <span class="s3">&quot;notifications&quot;: [</span>
    <span class="s3">{</span>
      <span class="s3">&quot;tokens&quot;: [&quot;token_a&quot;, &quot;token_b&quot;],</span>
      <span class="s3">&quot;platform&quot;: 1,</span>
      <span class="s3">&quot;message&quot;: &quot;Hello World iOS!&quot;</span>
    <span class="s3">},</span>
    <span class="s3">{</span>
      <span class="s3">&quot;tokens&quot;: [&quot;token_a&quot;, &quot;token_b&quot;],</span>
      <span class="s3">&quot;platform&quot;: 2,</span>
      <span class="s3">&quot;message&quot;: &quot;Hello World Android!&quot;</span>
    <span class="s3">},</span>
    <span class="s3">{</span>
      <span class="s3">&quot;tokens&quot;: [&quot;token_a&quot;, &quot;token_b&quot;],</span>
      <span class="s3">&quot;platform&quot;: 3,</span>
      <span class="s3">&quot;message&quot;: &quot;Hello World Huawei!&quot;,</span>
      <span class="s3">&quot;title&quot;: &quot;Hello with HMS&quot;</span>
    <span class="s3">},</span>
    <span class="s3">.....</span>
  <span class="s3">]</span>
<span class="s3">}</span>
<span class="s3">```</span>

</pre>
</body>
</html>